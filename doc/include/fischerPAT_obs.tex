%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 % File automatically generated by IMITATOR
 % Version  : IMITATOR 2.7-beta4 "Butter Guéméné" (build 1205)
 % Model    : 'examples/Fischer/fischerPAT_obs.imi'
 % Generated: Mon Jul 20, 2015 10:34:13
 % 
 % (node positioning not yet supported, you may need to manually edit the file)
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \documentclass[a4paper,10pt]{article}
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % PACKAGES
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \usepackage[T1]{fontenc}
% 
% \usepackage[utf8]{inputenc}
% 
% \usepackage{subcaption}
% 
% % Tikz
% \usepackage{tikz}
% \usetikzlibrary{arrows,automata}
\tikzstyle{every node}=[initial text=]
\tikzstyle{location}=[rectangle, rounded corners, minimum size=12pt, draw=black, inner sep=1.5pt]
\tikzstyle{invariant}=[draw=black, xshift=-1em, inner sep=1pt]
\tikzstyle{urgent}=[dotted, draw=red, very thick]


\definecolor{coloract}{rgb}{0.50, 0.70, 0.30}
\definecolor{colorclock}{rgb}{0.4, 0.4, 1}
\definecolor{colordisc}{rgb}{1, 0, 1}
% \definecolor{colorloc}{rgb}{0.4, 0.4, 0.65}
%%% NOTE: better in black
\definecolor{colorloc}{rgb}{0, 0, 0}
\definecolor{colorparam}{rgb}{1, 0.6, 0.0}

% Set of colors
\definecolor{loccolor1}{rgb}{1, 0.3, 0.3}
\definecolor{loccolor2}{rgb}{0.3, 1, 0.3}
\definecolor{loccolor3}{rgb}{0.3, 0.3, 1}
\definecolor{loccolor4}{rgb}{1, 0.3, 1}
\definecolor{loccolor5}{rgb}{1, 1, 0.3}
\definecolor{loccolor6}{rgb}{0.3, 1, 1}
\definecolor{loccolor7}{rgb}{0.9, 0.6, 0.2}
\definecolor{loccolor8}{rgb}{0.7, 0.4, 1}
\definecolor{loccolor9}{rgb}{0.5, 1, 0.75}
\definecolor{loccolor10}{rgb}{0.8, 0.7, 0.6}
\definecolor{loccolor11}{rgb}{0.6, 0.7, 0.8}
\definecolor{loccolor12}{rgb}{0.2, 0.5, 0.9}
\definecolor{loccolor13}{rgb}{0.5, 0.9, 0.2}
\definecolor{loccolor14}{rgb}{0.9, 0.2, 0.5}
\definecolor{loccolor15}{rgb}{0.7, 0.7, 0.7}
\definecolor{loccolor16}{rgb}{0.8, 0.8, 0.5}

\newcommand{\styleact}[1]{\ensuremath{\textcolor{coloract}{\mathrm{#1}}}}
\newcommand{\styleclock}[1]{\ensuremath{\textcolor{colorclock}{\mathrm{#1}}}}
\newcommand{\styleconst}[1]{\ensuremath{\textcolor{black}{\mathrm{#1}}}} %% ADDED FOR CONSTANTS
\newcommand{\styledisc}[1]{\ensuremath{\textcolor{colordisc}{\mathrm{#1}}}}
\newcommand{\styleloc}[1]{\ensuremath{\textcolor{colorloc}{\mathrm{#1}}}}
\newcommand{\styleparam}[1]{\ensuremath{\textcolor{colorparam}{\mathrm{#1}}}}

% \newcommand{\imitator}{\textsc{Imitator}}

% \title{An IMITATOR model}
% \author{IMITATOR}
% 
% 
% \begin{document}
% 
% \thispagestyle{empty}

\begin{figure}
\newcommand{\ratio}{0.9\textwidth}
	\footnotesize
	\centering
	 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% automaton proc1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\begin{subfigure}[b]{\ratio}
	\centering
	\begin{tikzpicture}[scale=2.5, auto, ->, >=stealth']
 
		\node[location, initial, fill=loccolor1] at (0,0) (idle1) {\styleloc{idle1}};
 
		\node[location, fill=loccolor2] at (-1.5, -1) (active1) {\styleloc{active1}};
		% Invariant of location active1
		\node [invariant,left] at (active1.west) {\begin{tabular}{@{} c @{\ } c@{} }& $ \styleclock{x1} \leq \styleparam{delta}$\\\end{tabular}};
 
		\node[location, fill=loccolor3] at (0,-2) (check1) {\styleloc{check1}};
 
		\node[location, fill=loccolor4] at (0,-3) (access1) {\styleloc{access1}};
 
		\node[location, fill=loccolor5] at (1,-3) (CS1) {\styleloc{CS1}};
 

		\path (idle1) edge[bend right] node[left]{\begin{tabular}{@{} c @{\ } c@{} }
		& $ \styledisc{turn} = \styleconst{IDLE}$\\
		 & $\styleact{try\_1}$\\
		 & $\styleclock{x1}:=0$\\
		\end{tabular}} (active1);
 

		\path (active1)[bend right] edge node[below left]{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{update\_1}$\\
		 & $\styleclock{x1}:=0$\\
		 & $\styledisc{turn}:=1$\\% 
		\end{tabular}} (check1);
 

		\path (check1) edge node[left]{\begin{tabular}{@{} c @{\ } c@{} }
		& $ \styleclock{x1} \geq \styleparam{gamma}
$\\
		$\land$ & $ \styledisc{turn} = 1$\\
		 & $\styleact{access\_1}$\\
		 & $\styleclock{x1}:=0$\\
		\end{tabular}} (access1);

		%%% NOTE: replace both transitions with '<>'
% 		\path (check1) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		& $ \styledisc{turn} > 1
% $\\
% 		$\land$ & $ \styleclock{x1} \geq \styleparam{gamma}$\\
% 		 & $\styleact{no\_access\_1}$\\
% 		 & $\styleclock{x1}:=0$\\
% 		\end{tabular}} (idle1);
% 
% 		\path (check1) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		& $ 1 > \styledisc{turn}
% $\\
% 		$\land$ & $ \styleclock{x1} \geq \styleparam{gamma}$\\
% 		 & $\styleact{no\_access\_1}$\\
% 		 & $\styleclock{x1}:=0$\\
% 		\end{tabular}} (idle1);
		\path (check1) edge node{\begin{tabular}{@{} c @{\ } c@{} }
		& $ \styledisc{turn} \neq 1
$\\
		$\land$ & $ \styleclock{x1} \geq \styleparam{gamma}$\\
		 & $\styleact{no\_access\_1}$\\
		 & $\styleclock{x1}:=0$\\
		\end{tabular}} (idle1);
 

		\path (access1) edge node[below]{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{enter\_1}$\\
		 & $\styledisc{counter}:=\styledisc{counter} + 1$\\% 
		\end{tabular}} (CS1);
 

		\path (CS1) edge[bend right] node[above right]{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{exit\_1}$\\
		 & $\styleclock{x1}:=0$\\
		 & $\styledisc{counter}:=\styledisc{counter} -1$\\% \n
		 & $\styledisc{turn}:=\styleconst{IDLE}$\\% 
		\end{tabular}} (idle1);
	\end{tikzpicture}
	
	\caption{Process 1}
	\label{pta:proc1}
	\end{subfigure}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % automaton proc2
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 	\begin{subfigure}[b]{\ratio}
% 	\begin{tikzpicture}[scale=2, auto, ->, >=stealth']
%  
% 		\node[location, initial, fill=loccolor1] at (0,0) (idle2) {\styleloc{idle2}};
%  
% 		\node[location, fill=loccolor2] at (0,-1) (active2) {\styleloc{active2}};
% 		% Invariant of location active2
% 		\node [invariant,right] at (active2.east) {\begin{tabular}{@{} c @{\ } c@{} }& $ \styleparam{delta} \geq \styleclock{x2}$\\\end{tabular}};
%  
% 		\node[location, fill=loccolor3] at (0,-2) (check2) {\styleloc{check2}};
%  
% 		\node[location, fill=loccolor4] at (0,-3) (access2) {\styleloc{access2}};
%  
% 		\node[location, fill=loccolor5] at (0,-4) (CS2) {\styleloc{CS2}};
%  
% 
% 		\path (idle2) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		& $ \styledisc{turn} + 1 = 0$\\
% 		 & $\styleact{try\_2}$\\
% 		 & $\styleclock{x2}:=0$\\
% 		\end{tabular}} (active2);
%  
% 
% 		\path (active2) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		 & $\styleact{update\_2}$\\
% 		 & $\styleclock{x2}:=0$\\
% 		 & $\styledisc{turn}:=2$\\% 
% 		\end{tabular}} (check2);
%  
% 
% 		\path (check2) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		& $ \styleclock{x2} \geq \styleparam{gamma}
% $\\
% 		$\land$ & $ \styledisc{turn} = 2$\\
% 		 & $\styleact{access\_2}$\\
% 		 & $\styleclock{x2}:=0$\\
% 		\end{tabular}} (access2);
% 
% 		\path (check2) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		& $ \styledisc{turn} > 2
% $\\
% 		$\land$ & $ \styleclock{x2} \geq \styleparam{gamma}$\\
% 		 & $\styleact{no\_access\_2}$\\
% 		 & $\styleclock{x2}:=0$\\
% 		\end{tabular}} (idle2);
% 
% 		\path (check2) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		& $ 2 > \styledisc{turn}
% $\\
% 		$\land$ & $ \styleclock{x2} \geq \styleparam{gamma}$\\
% 		 & $\styleact{no\_access\_2}$\\
% 		 & $\styleclock{x2}:=0$\\
% 		\end{tabular}} (idle2);
%  
% 
% 		\path (access2) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		 & $\styleact{enter\_2}$\\
% 		 & $\styledisc{counter}:=\styledisc{counter} + 1$\\% 
% 		\end{tabular}} (CS2);
%  
% 
% 		\path (CS2) edge node{\begin{tabular}{@{} c @{\ } c@{} }
% 		 & $\styleact{exit\_2}$\\
% 		 & $\styleclock{x2}:=0$\\
% 		 & $\styledisc{counter}:=\styledisc{counter} + -1$\\% \n
% 		 & $\styledisc{turn}:=-1$\\% 
% 		\end{tabular}} (idle2);
% 	\end{tikzpicture}
% 	\caption{PTA proc2}
% 	\label{pta:proc2}
% 	\end{subfigure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% automaton observer
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	\begin{subfigure}[b]{\ratio}
	\centering
	\begin{tikzpicture}[scale=1, node distance=3cm, auto, ->, >=stealth']
 
		\node[location, initial, fill=loccolor1] (obs_waiting) {\styleloc{obs\_waiting}};
 
		\node[location, fill=loccolor2, below left of=obs_waiting] (obs_1) {\styleloc{obs\_1}};
 
		\node[location, fill=loccolor3, below right of=obs_waiting] (obs_2) {\styleloc{obs\_2}};
 
		\node[location, fill=loccolor4, below left of=obs_2] (obs_violation) {\styleloc{obs\_violation}};
 

		\path (obs_waiting) edge[bend left] node{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{enter\_1}$\\
		\end{tabular}} (obs_1);

		\path (obs_waiting) edge[bend right] node{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{enter\_2}$\\
		\end{tabular}} (obs_2);
 

		\path (obs_1) edge[bend left] node{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{exit\_1}$\\
		\end{tabular}} (obs_waiting);

		\path (obs_1) edge node[below left]{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{enter\_2}$\\
		\end{tabular}} (obs_violation);
 

		\path (obs_2) edge[bend right] node[right]{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{exit\_2}$\\
		\end{tabular}} (obs_waiting);

		\path (obs_2) edge node{\begin{tabular}{@{} c @{\ } c@{} }
		 & $\styleact{enter\_1}$\\
		\end{tabular}} (obs_violation);
 
	\end{tikzpicture}
	
	\caption{PTA observer}
	\label{pta:observer}
	\end{subfigure}
\caption{Fischer mutual exclusion protocol (graphical \NIPTA{})}
\label{figure:fischer}
\end{figure}

% \end{document}
